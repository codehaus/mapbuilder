<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Technical Design</title><link rel="stylesheet" href="/Users/rajsingh/projects/mapbuilder/design/docbook/../html/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"></head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<!--#include file="top.inc" -->

<div class="article" lang="en">

<div class="titlepage"><div><div><h2 class="title"><a name="d0e1"></a>Technical Design</h2></div></div><div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>1. <a href="#d0e4">Overview</a></dt><dt>2. <a href="#d0e29">Functional Overview</a></dt><dt>3. <a href="#d0e50">Map publishing</a></dt><dt>4. <a href="#d0e138">Map viewing</a></dt><dd><dl><dt>4.1. <a href="#d0e149">Basic mapping</a></dt><dt>4.2. <a href="#d0e156">Getting event descriptions</a></dt><dt>4.3. <a href="#d0e161">Bookmarking locations</a></dt></dl></dd><dt>5. <a href="#d0e166">Data entry (Community Updates)</a></dt><dd><dl><dt>5.1. <a href="#d0e171">Data management</a></dt><dt>5.2. <a href="#d0e195">Data entry</a></dt></dl></dd><dt><a href="#d0e219">Bibliography</a></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4"></a>1.&nbsp;Overview</h2></div></div><div></div></div><p>The Community Map Builder (CMB) is a framework for collaborative,
    open sharing of place-based information. It builds upon components that
    conform to Open GIS's international Standards for geospatial software
    development. The aim is to create business logic components to repurpose
    Open Source, OpenGIS-compliant components for this effort. Map serving
    will use the OpenGIS<span class="emphasis"><em> Web Map Server</em></span>-compliant
    software, <a href="http://mapserver.gis.umn.edu" target="_top">Mapserver.</a>
    Spatial feature updating will use the OpenGIS <span class="emphasis"><em>Web Feature Server</em></span>-compliant
    software <a href="http://geoserver.sourceforge.net" target="_top">Geoserver</a>,
    which relies upon Postgres and the PostGIS component as its spatial
    database. CMB also uses Postgres as a normal database to store
    community-contributed text and photographs.</p><p>Community Map Builder is more than just a collection of
    technologies. It is a collection of Web pages, server applications and
    database schema, along with implementation recommendations.</p><div class="figure"><a name="d0e23"></a><p class="title"><b>Figure&nbsp;1.&nbsp;High Level Design</b></p><div class="mediaobject"><img src="HighLevelDesign.png" alt="High Level Design"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e29"></a>2.&nbsp;Functional Overview</h2></div></div><div></div></div><p>CMB is designed around two use cases, enabling people to share
    knowledge about good bicycling routes and sea kayaking trips. These will
    be referred to generically as "events" throughout this document.
    We expect users to want to:</p><div class="itemizedlist"><ul type="disc"><li><p>Browse a map featuring events, optionally with interesting base
        map information</p></li><li><p>See events from other CMB sites on the map.</p></li><li><p>Click on an event to view the event publisher's comments and
        pictures</p></li><li><p>Drill down to see the comments and pictures of other
        contributors (OPTIONAL--VERSION 2?)</p></li><li><p>Post new events to the site including text and pictures (and
        movies and sounds?)</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e50"></a>3.&nbsp;Map publishing</h2></div></div><div></div></div><p>The first task is to specify a standard for map publishing, so that
    CMB users can quickly and easily locate places of interest. The technology
    used for this purpose will be a map server called, appropriately enough,
    <a href="http://mapserver.gis.umn.edu" target="_top">Mapserver</a>. This software
    offers the project the ability to publish maps in an OpenGIS-compliant
    way. It also allows users to click on a place of interest and get detailed
    information about that location. In the near future, it will support the
    ability for users to "bookmark" an area of interest (via the Web
    Map Context specification), to easily get back to that place in the
    future, or to email a URL for the map with an exact location to someone
    else.</p><p>To promote interoperability, and especially future integration of
    Community Map systems, we specify a standard naming scheme for geographic
    features:</p><div class="table"><a name="d0e60"></a><p class="title"><b>Table&nbsp;1.&nbsp;Standard Layer Naming Scheme</b></p><table summary="Standard Layer Naming Scheme" border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><span class="emphasis"><em>Geographic Feature</em></span></td><td><span class="emphasis"><em>Name</em></span></td><td><span class="emphasis"><em>Notes</em></span></td></tr><tr><td>Event / Trip / Route PATH</td><td>EVENT</td><td>label with event name</td></tr><tr><td>Event / Trip / Route start and end</td><td>EVENTPT</td><td>label with event name</td></tr><tr><td>Roads</td><td>ROADS</td><td>Handle highway, street, dirt road, etc. symbolization using
            multiple CLASS attributes in MAP file</td></tr><tr><td>Lakes and ponds</td><td>WATERBODY</td><td>includes all polygon water features</td></tr><tr><td>Rivers, streams</td><td>WATERFLOW</td><td>includes all linear water features</td></tr><tr><td>Local boundary</td><td>BOUND1</td><td>&nbsp;</td></tr><tr><td>State boundary</td><td>BOUND2</td><td>&nbsp;</td></tr><tr><td>Other boundary</td><td>BOUND3</td><td>&nbsp;</td></tr><tr><td>Nation boundary</td><td>BOUND4</td><td>&nbsp;</td></tr></tbody></table></div><p>Geographic data may be stored in any format supported by Mapserver.
    However, the event data MUST be stored in Postgis to allow for automated
    updates.</p><p>A sample template for the Mapserver MAP file is presented in
    Appendix A [TODO]. All layers are specified as Shapefiles, except for
    EVENT and EVENTPT</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e138"></a>4.&nbsp;Map viewing</h2></div></div><div></div></div><p>The CMB map viewing client uses HTML and Javascript.</p><div class="figure"><a name="d0e143"></a><p class="title"><b>Figure&nbsp;2.&nbsp;Map viewer WMS client</b></p><div class="mediaobject"><img src="images/wmsclient.gif" alt="Map viewer WMS client"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e149"></a>4.1.&nbsp;Basic mapping</h3></div></div><div></div></div><p>The basic map interface will allow users to pan and zoom on a map.
      The map will consist of events (trips) and base features, such as roads,
      water features and administrative boundaries (towns, counties, states,
      nations, etc). There will be a legend, scale bar and north arrows. The
      legend and scale bars will be context-sensitive, taking advantage of
      Mapserver's capabiliities in this area. An example template for the
      map viewing client Web page is in Appendix B [TODO].</p><p>Notice that the map viewing client produces requests that are
      compliant to the OGC WMS specification instead of the internal Mapserver
      format. This is to promote greater interoperability with other Web
      mapping systems.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e156"></a>4.2.&nbsp;Getting event descriptions</h3></div></div><div></div></div><p>The map viewing client will also allow the user to click on events
      to get descriptions, which consist of narrative text and other media.
      This is accomplished by generating a GetFeatureInfo request, and
      displaying the results in a new Web page, whose format is listed in
      Appendix B [TODO].</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e161"></a>4.3.&nbsp;Bookmarking locations</h3></div></div><div></div></div><p>[TODO] Future functionality or now? Have a button that generates
      the Web Map Context XML.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e166"></a>5.&nbsp;Data entry (Community Updates)</h2></div></div><div></div></div><p>The CMB's primary function is to allow users to share
    information. This requires a system for people to add information to the
    database. To enable a wide range of publishers with various system
    administration expertise to participate in the CMB framework, we will
    support many methods of information updating. The first to be defined is a
    semi-automated file-based process defined here.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e171"></a>5.1.&nbsp;Data management</h3></div></div><div></div></div><p>The current data architecture reflects the bike and kayak trip use
      cases, as we generally expect users to upload trips that have a begin
      point, an end point, and a linear path between the two. Trips are
      generically called events.</p><div class="figure"><a name="d0e176"></a><p class="title"><b>Figure&nbsp;3.&nbsp;Database schema</b></p><div class="mediaobject"><img src="images/dbtables.png" alt="Database schema"></div></div><p>Events will have rich descriptive information attached to them. In
      this release we explicitly support text and images, although other media
      may work. This content is stored in a directory on disk in a Web
      server-accessible location. We store content on disk to avoid the
      complexities involved with storing data types such as images, movies,
      sounds in the database. The STORY database table manages the
      relationship between events and content.</p><p>When a GetFeatureInfo request is made from the map viewing client,
      the CMB queries the START, END, AND PATH fields of EVENT, finding the
      event closest to the user's map click. Then a Web page is created
      that contains the content the event creator entered, which is found by
      querying the STORY table for the STORYID and USERID that matches those
      from the EVENT table. Then all the matching STORYIDs from the CONTENT
      table are retrieved and the files they reference are displayed. </p><p>The HTMLFILE and MEDIAFILE fields contain URL references. They are
      paired in this way to make sure text that goes with a particular file is
      kept together. Either of these fields, however, may be null. </p><p>Above this content is a title consisting of the NAME value from
      the EVENT table. </p><p>Below this content are links to content other users have created,
      which are found by querying the STORY table for EVENTIDs that match the
      EVENT table, but have a USERID that <span class="emphasis"><em>does not</em></span> match.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e195"></a>5.2.&nbsp;Data entry</h3></div></div><div></div></div><p>The database schema presented above naturally defines the type of
      information required from the user. This will be obtained by presenting
      the user with a set of HTML forms to fill out, presented like a
      wizard-driven user interface. In its first release, this information
      will be uploaded and stored on disk in a temporary area. A CMB
      administrator must regularly examine this directory for new information,
      review it for appropriateness, and run a script that populates the
      database and the public Web directory with the content. The
      administrator can either let the script create new user IDs and event
      IDs or manually specify existing user and/or event IDs.</p><p>This graphic shows the layout of data content on disk:</p><div class="figure"><a name="d0e202"></a><p class="title"><b>Figure&nbsp;4.&nbsp;Web content file structure</b></p><div class="mediaobject"><img src="images/directories.png" alt="Web content file structure"></div></div><p></p><p>The first task is to obtain the spatial location of the event from
      the user. We do this by presenting a second map viewer with no pan or
      zoom capability. The page has three radio buttons that the user selects
      from to define the type of data being entered. These are "Event
      start point", "Event end point", and "Event route".
      The start and end point button selections trigger a javascript function
      that accepts the last mouse click as the point of interest. It also tags
      the point as being either the start or end. The route selection triggers
      a javascript function that allows the user to draw a line. There is also
      a button that deletes the last feature drawn.</p><p>[TODO graphic: event entry ]</p><p>After the spatial data is entered, the user clicks a button to
      move on to a non-spatial information entry form. The spatial data is
      saved as hidden fields in this new form. Here the user enters HTML
      fragments and uploads media files.</p><p>[TODO graphic: content entry]</p><p></p><p></p></div></div><div class="bibliography"><div class="titlepage"><div><div><h2 class="title"><a name="d0e219"></a>Bibliography</h2></div></div><div></div></div><div class="bibliomixed"><p class="bibliomixed"><span class="bibliomset"> <i>Web Map
    Service Implementation Specification</i> <a href="http://www.opengis.org" target="_top">OGC_WMS_Spec</a><span class="edition">1.1.0</span>
    <span class="pubdate">June 12, 2001</span> <span class="publisher"><span class="publishername">OpenGIS Consortium, Inc.</span></span>
    <span class="editor"><span class="firstname">Jeff</span><span class="surname">de La Beaujardi&eacute;re</span></span>
    </span></p></div><div class="bibliomixed"><p class="bibliomixed"><span class="bibliomset"> <i>University of
    Minnesota MapServer</i> <a href="http://mapserver.gis.umn.edu/" target="_top">UMN_Mapserver</a><span class="edition">3.6.5</span>
    <span class="publisher"><span class="publishername">University of Minnesota</span></span> </span></p></div><div class="bibliomixed"><p class="bibliomixed"><span class="bibliomset"> <i>PostGIS:
    Geographic objects for PostgreSQL</i> <a href="http://postgis.refractions.net/" target="_top">PostGIS</a><span class="edition">0.7.5</span>
    </span></p></div><div class="bibliomixed"><p class="bibliomixed"><span class="bibliomset"> <i>GeoServer WFS</i><a href="http://geoserver.sourceforge.net/html/index.php" target="_top">GeoServer</a><span class="edition">0.95</span>
    </span></p></div><div class="bibliomixed"><p class="bibliomixed"><span class="citetitle"><i class="citetitle">PostGIS Web hosting from PgHoster</i></span>
    <a href="http://www.pghoster.com" target="_top">PostGIS_webhosting</a></p></div></div></div></body></html>
