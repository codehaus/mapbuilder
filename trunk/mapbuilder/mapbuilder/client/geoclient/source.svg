<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>

<?xml-stylesheet href="geoclient.css" type="text/css"?>

<!-- 

This is an open source project (see definition at http://www.opensource.org/docs/definition_plain.html).

and is distributed under the GNU General Public License (see http://www.gnu.org/copyleft/lesser.html).

-->

<svg id="thesvg" onload="execScript(evt)"

	  style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision;"  

     xmlns="http://www.w3.org/2000/svg"

	  xmlns:a3="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"

	  a3:scriptImplementation="Adobe"

     xmlns:gml="http://www.opengis.org/gml"

     xmlns:xlink="http://www.w3.org/1999/xlink">

<!--

<svg id="thesvg" onload="execScript(evt)"

	  style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision;"  

     xmlns="http://www.w3.org/2000/svg"

	  xmlns:xlink="http://www.w3.org/1999/xlink"

     xmlns:gml="http://www.opengis.org/gml">

-->

<script xlink:href="geoclient.jsgz"/>

<script xlink:href="widget.jsgz"/>

<script xlink:href="setting.jsgz"/>

<script xlink:href="legend.jsgz"/>

<script><![CDATA[

var svgdoc;

var theLayers= new Array();

var bound={x1:10E38,y1:10E38,x2:-10E38,y2:-10E38};

var sldnode;var eldnode; var fcnode;



function execScript(evt){

	var targ = evt.getTarget();

	svgdoc = targ.getOwnerDocument();

	if(window!=null) window.beforeunload=unloadWidget();

	if(window.parent!=null) window.parent.beforeunload=unloadWidget();

	arrangeSVG(evt,0.8);

	init(evt);

	initzp(evt);

	createToolbarButton(evt)

}

function pn(obj){

	return printNode(obj);

}

function pxml(str){

	return parseXML(str,svgdoc);

}

function be(txt){

	browserEval(txt);

}

function doZoom(evt){

  SetStaticZP(evt); 

}

function doScroll(evt){

	SetStaticZP(evt);

}

function getFeature(){};

function init(evt){

	sldnode = svgdoc.getElementsByTagName('StyledLayerDescriptor').item(0);

	eldnode = svgdoc.getElementsByTagName('ExtendedLayerDescriptor').item(0);

	fcnode = svgdoc.getElementsByTagName('featureCollection').item(0);

	createLayers();

	createExtent();	

	addPanBox();

	addEvents();

}

function createLayers(){

	mapLay = svgdoc.getElementById('mapLayers');

	mapLays = mapLay.getElementsByTagName("g");

	if (mapLays.length<1) return;

	for (i=0;i<mapLays.length;i++){

		feats =mapLays.item(i).getChildNodes();

		for (j=0;j<feats.length;j++){

			if (feats.item(j).nodeName!="#text") {

				getbound(feats.item(j));		

			}

		}

	}

//shuffle the stack order

	eldest = mapLays.item(0);	

	nmv = mapLays.length;

	for (i=0;i<nmv;i++){

		movedg = mapLays.item(nmv-1);

		if (movedg==eldest) break;

		mapLay.removeChild(movedg);

		mapLay.insertBefore(movedg,eldest);

	}

}



function getbound(p2){

	if(p2==null) return;

	bbx=p2.getBBox();

	bound.x1=Math.min(bound.x1,bbx.x);

	bound.x2=Math.max(bound.x2,(bbx.x+bbx.width));

	bound.y1=Math.min(bound.y1,bbx.y);

	bound.y2=Math.max(bound.y2,(bbx.y+bbx.height));

}

function createExtent(){

	mapLay = svgdoc.getElementById("mapLayers");

	keyMap = svgdoc.getElementById("keyMap");

	map = svgdoc.getElementById("map");

	vbstr=bound.x1+" "+bound.y1+" "+(bound.x2-bound.x1)+" "+(bound.y2-bound.y1);

	h2=bound.y2+bound.y1;

	matrix="matrix(1 0 0 -1 0 "+h2+")";

	map.setAttribute("viewBox",vbstr);

	keyMap.setAttribute("viewBox",vbstr);

	mapLay.setAttribute("transform",matrix);



  backgr=svgdoc.getElementById("bg");

  backgr.setAttribute("x",bound.x1);

  backgr.setAttribute("y",bound.y1);

  backgr.setAttribute("width",bound.x2-bound.x1);

  backgr.setAttribute("height",bound.y2-bound.y1);

}



]]></script>

<metadata>

<!--TEST1-->

</metadata>

	<svg id="map" >

		<g id="mapLayers" style="fill:none;fill-rule:evenodd;stroke-antialiasing:true;">

			<rect id="bg" style="fill:white;opacity:0;"/>

			<rect id="zoomer" x="0" y="0" width="0" height="0" style="visibility: hidden; fill: none;stroke:red;stroke-width:1"/>

			<line id="panner" x1="0" y1="0" x2="0" y2="0" style="visibility: hidden; stroke:red;stroke-width:1"/>

			<path id="pathadder" style="fill:none;visibility: hidden; stroke:red;stroke-width:0.1" d=""/>

			<path id="pathadder2" style="fill:magenta;fill-rule:evenodd;opacity:0.3;visibility: hidden; stroke:red;stroke-width:0.1" d=""/>

			<!--TEST2-->

		</g>

	</svg>

	<svg id="keyMap" >

		<use id="useMapLayers" xlink:href="#mapLayers" x="0" y="0" width="100%" height="100%" />

		<g id="keyMapLayers" class="keymaplayers"/>

	</svg>

	<svg id="legend" x="0" y="0" width="2" height="100" >

		<rect id="legBack" x="0" y="0" width="100%" height="100%" class="legendbackground"/>

		<svg id='tester' x="0" y="0" width="2" height="100" preserveAspectRatio="xMinyMin meet">

			<g id='legendLayers'>

				<text x="2" y="12" class="legendtitle">GeoClient</text>

				<a>

					<g id="cboxes" transform="translate(2,36)" onclick='chk(evt);'></g>

					<g id="legends" transform="translate(20,36)" onclick="showSymbolEditor(evt,'changeSymbolColor(evt)')"></g>

					<g id="keylabels" transform="translate(20,36)" onclick="showLegendTypeChanger(evt)"></g>

				</a>

			</g>

		</svg>

		<g id='legbutton'>

			<rect id="butBack" x="0" y="0" width="1000" height="18" class="scrollerback"/>

			<text x="2" y="12" class="legendtitle">Legend</text>

			<use id="legup" onclick="legscroll(evt)" onmousedown="chbutd(evt)" onmouseup="chbutu(evt)" xlink:href="#triangleup" x="0" y="0" width="14" height="14" />

			<use id="legdown" onclick="legscroll(evt)" onmousedown="chbutd(evt)" onmouseup="chbutu(evt)" xlink:href="#triangledown" x="0" y="0" width="14" height="14" />

		</g>

	</svg>

	<svg id="geoWin" viewBox="0 0 100 100" x="0" y="0" width="1" height="1" display="" preserveAspectRatio="xMinYMin slice" />

	<rect id="windowcover" fill="none" x="0" y="0" width="1" height="1" pointer-events="none"/>

	<svg id="toolbar" style="text-rendering:optimizeLegibility;" width="100" height="30" preserveAspectRatio="xMidyMid meet" onmouseover="" onmouseout="" >

		<rect pointer-events="none" id='hh' x='0' y='0' width='100%' height='100%' class="toolbarback"/>

		<line x1="0" y1="100%" x2="100%" y2="100%" class="toolbarshadow"/>

		<line x1="100%" y1="100%" x2="100%" y2="0" class="toolbarshadow"/>

		<line x1="0" y1="0" x2="0" y2="100%" class="toolbarlight"/>

		<line x1="0" y1="0" x2="100%" y2="0" class="toolbarlight"/>

	</svg>

	<defs id="map_symbols">

		<use id="masterUse" xlink:href="" x="0" y="0" width="100%" height="100%" />

		<use id="usetest" xlink:href=""></use>

		<symbol id='marker' viewBox="0 0 20 20" preserveAspectRatio="xMidyMid meet">

			<ellipse cx="10" cy="10" rx="10" ry="10"/>

		</symbol>

		<symbol id='fill' viewBox="0 0 20 20" preserveAspectRatio="xMidyMid meet">

			<rect x="0" y="0" width="20" height="20" />

		</symbol>

		<symbol id='pen' viewBox="0 0 20 20" preserveAspectRatio="xMidyMid meet">

			<path d="M 0 16 L 7 3 L 14 16 L 20 0" fill="none"/>

		</symbol>

		<symbol id="check" viewBox="0 0 10 10" preserveAspectRatio="xMidyMid meet">

			<rect class="checkbox" x="0" y="0" width="10" height="10"/>

			<path class="checkmark" d="M2,5 L5,8 8,2"/>

		</symbol>

		<symbol id="uncheck" viewBox="0 0 10 10" preserveAspectRatio="xMidyMid meet">

			<rect class="checkbox" x="0" y="0" width="10" height="10"/>

		</symbol>

		<symbol id="triangledown" viewBox="0 0 10 10" preserveAspectRatio="xMidyMid meet">

			<path class="scrollershadow" d="M1,1 L5,9 9,1 z" transform="translate(1,1)" />

			<path class="scrollerface" d="M1,1 L5,9 9,1 z"/>

			<path class="scrollerlight" d="M5,9 L1,1 9,1"/>

		</symbol>

		<symbol id="triangledown2" viewBox="0 0 10 10" preserveAspectRatio="xMidyMid meet">

			<path class="scrollerfacedown" d="M1,1 L5,9 9,1 z"/>

		</symbol>

		<symbol id="droparrow" viewBox="0 0 10 10" preserveAspectRatio="xMidyMid meet">

			<path class="toolbarback" stroke='#000' d="M2,2 L5,8 8,2 z"/>

		</symbol>

		<symbol id="uparrow" viewBox="0 0 10 10" preserveAspectRatio="xMidyMid meet">

			<path class="toolbarback" stroke='#000' d="M2,8 L5,2 8,8 z"/>

		</symbol>

		<symbol id="triangleup" viewBox="0 0 10 10" preserveAspectRatio="xMidyMid meet">

			<path class="scrollershadow" d="M1,9 L5,1 9,9 z" transform="translate(1,1)"/>

			<path class="scrollerface" d="M1,9 L5,1 9,9 z"/>

			<path class="scrollerlight" d="M1,9 L5,1 "/>

		</symbol>

		<symbol id="triangleup2" viewBox="0 0 10 10" preserveAspectRatio="xMidyMid meet">

			<path class="scrollerfacedown" d="M1,9 L5,1 9,9 z"/>

		</symbol>



		<symbol id="bt_up" viewBox="0 0 30 26" preserveAspectRatio="none">

			<rect class="buttonlight" id="r1" x="0" y="0" width="28" height="24" rx="5" ry="5" />

			<rect class="buttonshadow" id="r3" x="2" y="2" width="28" height="24" rx="5" ry="5"/>

			<rect class="buttonface" id="r2" x="1" y="1" width="28" height="24" rx="5" ry="5"/>

		</symbol>

		<symbol id="bt_down" viewBox="0 0 30 26" preserveAspectRatio="none">

			<rect class="buttonfacedown" id="r2" x="1" y="1" width="28" height="24" rx="5" ry="5"/>

		</symbol>

		<symbol id="keymap" viewBox="0 0 30 26" preserveAspectRatio="none">

			<path d="M15,4 V22 M6,13 H24" class="buttonstroke0"/>

			<polygon points="10,8 20,8 20,18 10,18" class="panner buttonstroke1"/>

		</symbol>

		<symbol id="legendsetting" viewBox="160 0 35 30" preserveAspectRatio="none">

			<path d="M188.556 14.8889 L181.773 24 L164.223 24 L172.023 14.8889 z"

				 style="fill:#080;stroke-width:1;stroke:#000"/>

			<path d="M189 10.4444 L182.217 19.5556 L164.667 19.5556 L172.467 10.4444 z"

				 style="fill:#FF0;stroke-width:1;stroke:#000"/>

			<path d="M189 6.44444 L182.217 15.5556 L164.667 15.5556 L172.467 6.44444 z"

				 style="fill:#0D0;stroke-width:1;stroke:rgb(0,0,0)"/>

		</symbol>

		<symbol id="pref" viewBox="0 0 30 26" preserveAspectRatio="none">

			<rect x="4" y="4" width="20" height="18" fill="#DDD" stroke="#000"/>

			<rect x="7" y="7" width="3" height="3" fill="#F00" stroke="#000"/>

			<rect x="7" y="12" width="3" height="3" fill="#0F0" stroke="#000"/>

			<rect x="7" y="17" width="3" height="3" fill="#00F" stroke="#000"/>

			<path d="M12,8 h8 M12,13 h8 M12,18 h8" class="buttonstroke0"/>

		</symbol>

		<symbol id="input" viewBox="0 0 30 26" preserveAspectRatio="none">

			<line x1="15" y1="6" x2="15" y2="20" stroke='#000'/>

			<line x1="9" y1="13" x2="21" y2="13" stroke='#000'/>

		</symbol>

		<symbol id="hilite" viewBox="0 0 30 26" preserveAspectRatio="none">

			<rect x="16" y="7" width="8" height="6" transform='translate(16,7) rotate(-30) translate(-16,-7)' stroke='black' fill='#090' />

			<path d="M3,10 L15,8 18,13 12,23 z " stroke='none' fill='inherit' />

		</symbol>

		<symbol id="labelsetting" viewBox="0 0 30 26" preserveAspectRatio="none">

			<polygon transform="translate(-3,0)" points="10,13 15,7 26,7 26,19 15,19" fill='#FF0' stroke='#000'/>

			<path transform="translate(-3,0)" d="M15,11 h9 M15,15 h9" stroke-width="2" stroke='#000' fill='none' />

		</symbol>

		<symbol id="autolabel" viewBox="0 0 30 26" preserveAspectRatio="none">

			<polygon points="10,13 15,7 26,7 26,19 15,19" fill='#090' stroke='#000'/>

			<polygon transform="translate(-3,3)" points="10,13 15,7 26,7 26,19 15,19" fill='lime' stroke='#000'/>

			<ellipse transform="translate(-3,3)" cx='16' cy='13' rx='2.5' ry='2.5' fill='#DDD' stroke='#000'/>

			<ellipse transform='translate(9,12) rotate(45) translate(-9,-9)' cx="9" cy="9" rx="7" ry="2" fill="none" stroke='#000'/>

		</symbol>

		<symbol id="label" viewBox="0 0 30 26" preserveAspectRatio="none">

			<polygon points="10,13 15,7 26,7 26,19 15,19" fill='#090' stroke='#000'/>

			<ellipse cx='16' cy='13' rx='2.5' ry='2.5' fill='#DDD' stroke='#000'/>

			<ellipse transform='translate(9,9) rotate(45) translate(-9,-9)' cx="9" cy="9" rx="7" ry="2" fill="none" stroke='#000'/>

		</symbol>

		<symbol id="identify" viewBox="0 0 30 26" preserveAspectRatio="none">

			<ellipse cx="15" cy="13" rx="10" ry="10" class="buttonfill0"/>

			<text x="12" y="19" class="buttonfont0">i</text>

		</symbol>

		<symbol id="helpz" viewBox="0 0 30 26" preserveAspectRatio="none">

			<text x="6" y="21" class="buttonfont">?</text>

		</symbol>

		<symbol id="find" viewBox="2 2 30 26" preserveAspectRatio="none">

			<g transform="translate(2,1)" style="fill:url(#green-metallic);stroke:#004400;stroke-width:.2">

				<rect x="6.3126" y="8.64304" width="5.12" height="8"/>

				<rect x="4.9113" y="16.8922" width="7.9" height="6.46"/>

				<rect x="5.70931" y="4.25491" width="6.335" height="4.16151"/>

				<rect x="17.8103" y="8.58636" width="5.12" height="8"/>

				<rect x="16.409" y="16.8356" width="7.9" height="6.46"/>

				<rect x="17.207" y="4.19823" width="6.335" height="4.16151"/>

				<rect x="11.4656" y="9.37506" width="6.4" height="5"/>

			</g>

		</symbol>

		<symbol id="zoomplus" viewBox="2 2 30 26" preserveAspectRatio="none" >

			<g id="df" pointer-events="none" class="buttonstroke0">

				<ellipse cx="14" cy="14" rx="9.5" ry="9.5"/>

				<line x1="21.3333" y1="19.8889" x2="28.8889" y2="25.2222"/>

				<line x1="8.44444" y1="14.5556" x2="19.5556" y2="14.5556"/>

				<line x1="13.7778" y1="19.4444" x2="13.7778" y2="9.22222"/>

			</g>

		</symbol>

		<symbol id="nozoom" viewBox="34 2 30 26" preserveAspectRatio="none">

			<g pointer-events="none" class="buttonstroke0">

				<ellipse cx="46" cy="13.6667" rx="9.5" ry="9.5" />

				<line x1="53.3333" y1="19.5556" x2="60.8889" y2="24.8889"/>

				<line x1="52.4444" y1="7" x2="39.1111" y2="20.3333" />

			</g>

		</symbol>

		<symbol id="zoommin" viewBox="66 2 30 26" preserveAspectRatio="none">

			<g pointer-events="none" class="buttonstroke0">

				<line x1="85.3333" y1="19.5556" x2="92.8889" y2="24.8889"/>

				<ellipse cx="78" cy="13.6667" rx="9.5" ry="9.5"/>

				<line x1="72.8889" y1="13.6667" x2="83.1111" y2="13.6667"/>

			</g>

		</symbol>

		<symbol id="quick" viewBox="0 0 30 26" preserveAspectRatio="none">

			<polygon points="10,23 13,15 10,15 13,09 9,09 13,3 19,3 15,09 18,09 14,15 16,15" class="toolbarback" stroke='#000'/>

		</symbol>

		<symbol id="minimizewin" viewBox="0 0 30 26" preserveAspectRatio="none">

				<rect fill="#003399" stroke="none" x="4" y="11" width="20" height="4"/>

		</symbol>

		<symbol id="restorewin" viewBox="0 0 30 26" preserveAspectRatio="none">

				<rect fill="none" stroke="#003399" stroke-width="4" x="7" y="5" width="16" height="14" />

		</symbol>

		<symbol id="closewin" viewBox="0 0 30 26" preserveAspectRatio="none">

			<line x1="6" y1="4" x2="24" y2="22" stroke='#000'/>

			<line x1="6" y1="22" x2="24" y2="4" stroke='#000'/>

		</symbol>

		<linearGradient id="green-metallic" x1="0%" y1="0%" x2="100%" y2="0%" spreadMethod="pad" gradientUnits="objectBoundingBox">

			<stop offset="1%" style="stop-color:rgb(118,166,128);stop-opacity:1"/>

			<stop offset="18%" style="stop-color:rgb(0,78,0);stop-opacity:1"/>

			<stop offset="48%" style="stop-color:rgb(164,188,168);stop-opacity:1"/>

			<stop offset="83%" style="stop-color:rgb(122,205,142);stop-opacity:1"/>

			<stop offset="99%" style="stop-color:rgb(0,78,0);stop-opacity:1"/>

		</linearGradient>

		<linearGradient id="litegrad" gradientUnits="objectBoundingBox" x1="1" y1="1" x2="0" y2="0">

			<stop offset=".3" class="hilitelight"/>

			<stop offset=".9" class="hilitedark"/>

		</linearGradient>

		<linearGradient id="bargrad" gradientUnits="objectBoundingBox" x1="0" y1="0" x2="1" y2="0">

			<stop offset=".0" style="stop-color:#003366"/>

			<stop offset=".8" style="stop-color:#0066CC"/>

		</linearGradient>

		<linearGradient id="homegrad" gradientUnits="objectBoundingBox" x1="0" y1="1" x2="0" y2="0">

			<stop offset=".0" style="stop-color:palegreen"/>

			<stop offset=".8" style="stop-color:rgb(00,88,00)"/>

		</linearGradient>

		<radialGradient id="buttongrad" gradientUnits="objectBoundingBox" x1="0" y1="1" x2="0" y2="0">

			<stop offset=".35" class="butlight"/>

			<stop offset=".99" class="butdark"/>

		</radialGradient>

		<radialGradient id="overgrad" gradientUnits="objectBoundingBox" x1="0" y1="1" x2="0" y2="0">

			<stop offset=".05" class="hilitelight"/>

			<stop offset=".90" class="hilitedark"/>

		</radialGradient>

		<linearGradient id="ltanx" gradientUnits="objectBoundingBox" x1="0" y1="1" x2="" y2="">

			<stop offset=".2" style="stop-color:chocolate"/>

			<stop offset=".8" style="stop-color:tan"/>

		</linearGradient>

		<linearGradient id="ltan" gradientUnits="objectBoundingBox" x1="0" y1="1" x2="" y2="">

			<stop offset=".2" style="stop-color:#CC9933"/>

			<stop offset=".8" style="stop-color:#FFCC99"/>

		</linearGradient>

		<linearGradient id="lflag" gradientUnits="objectBoundingBox" x1="0" y1="1" x2="0" y2="0">

			<stop offset=".05" style="stop-color:#FF0000"/>

			<stop offset=".65" style="stop-color:#FFFFFF"/>

		</linearGradient>

	</defs>



</svg>

