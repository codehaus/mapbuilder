<html>
<head>
<script type="text/javascript" src="/mapbuilder/lib/util/sarissa/Sarissa.js"></script>
<script type="text/javascript">
var progids = {domdoc: ['Msxml2.DOMDocument.6.0', 'Msxml2.DOMDocument.3.0'],
      freethreaded: ['Msxml2.FreeThreadedDOMDocument.6.0', 'Msxml2.FreeThreadedDOMDocument.3.0'],
      xsltpl: ['MSXML2.XSLTemplate.6.0', 'MSXML2.XSLTemplate.3.0'],
      xmlhttp: ['Msxml2.XMLHTTP.6.0', 'Msxml2.XMLHTTP.3.0']};
var xml;
for (var i in progids.domdoc) {
  try {
    xml = new ActiveXObject(progids.domdoc[i]);
    break;
  } catch (e) {}
}
var xsl = new ActiveXObject(progids.freethreaded[i]);
var docCache = new ActiveXObject(progids.xsltpl[i]);
var xmlHttp = new ActiveXObject(progids.xmlhttp[i]);
xmlHttp.open('GET', 'flickrrest2wfs.xsl', false);
xmlHttp.send(null);
var xslText = xmlHttp.responseText;
var regex = new RegExp("/\?url=(.[^']*)'/g");
var toReplace = xslText.match(/\?url=(.[^']*)'/g);
for (var i=0; i<toReplace.length; i++) {
	xslText = xslText.replace(toReplace[i], toReplace[i].replace(/%/g,'%25'));
}

xml.validateOnParse = false;
xsl.validateOnParse = false;
xsl.resolveExternals = true;
xsl.setProperty("AllowDocumentFunction",true); 
xsl.async = false;
xml.async = false;
xsl.loadXML(xslText);
xml.load('/mapbuilder/proxy?url=http%3A//www.flickr.com/services/rest%3Fmethod%3Dflickr.photos.search%26api_key%3Dafbacfb4d14cd681c04a06d69b24d847%26user_id%3D15435549%2540N00');
docCache.stylesheet = xsl;
var docProcessor = docCache.createProcessor();
docProcessor.input = xml;
docProcessor.addParameter('proxyUrl', '/mapbuilder/proxy', '');
docProcessor.transform();
var result = docProcessor.output;
alert(result);
</script>
</head>
<body>
</body>
</html>