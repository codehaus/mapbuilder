<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--
Description: A Browser based Web Map Server Client based on javascript and XSL
             libraries from http://mapbuilder.sourceforge.net .
Usage:       Call http://hostname/dir/wms.html?context=UrlOfContext
             or http://hostname/dir/wms.html (and a default context is used)
Licence:     GPL as per: http://www.gnu.org/copyleft/gpl.html

$Id$
$Name$
-->

<html>
  <head>
    <title>XSL Processor test page</title>

    <!-- Include mapbuilder libraries -->
    <script type="text/javascript" src="../lib/util/sarissa/Sarissa.js"></script>
    <link rel="stylesheet" href="../lib/skin/default/html.css" type="text/css">

    <script>

function XslProcessor(xslUrl) {
  // get the stylesheet document
  this.xslDom = Sarissa.getDomDocument();
  this.xslDom.async = false;
  this.xslDom.load(xslUrl);

  /**
   * Transforms XML in the provided xml node according to this XSL.
   * @param xmlNode The XML node to be transformed.
   * @return The transformed String.
   */
  this.transformNode=function(xmlNode) {
    // transform and build a web page with result
    s=new String(xmlNode.transformNode(this.xslDom));
    // Some browsers XSLT engines don't transform &lt; &gt; to < >, so do it here.
    a=s.split("&lt;");
    s=a.join("<");
    a=s.split("&gt;");
    s=a.join(">");
    return s;
  }

  this.transformNodeToObject=function(xmlNode) {
    // transform and build a web page with result

    var result = Sarissa.getDomDocument();
    xmlNode.transformNodeToObject(this.xslDom, result);
    return result;
  }

  this.pureMozillaXslt=function(xmlDoc) {
        var xsltProcessor = new XSLTProcessor();
        xsltProcessor.importStylesheet(this.xslDom);
        var newFragment = xsltProcessor.transformToFragment(xmlDoc, document);
        return newFragment;
  }

}




    </script>


  </head>

  <body>
    <h1><a href="http://mapbuilder.sourceforge.net">Mapbuilder</a>
      XSL test page</h1>

    <!-- Layout mapbuilder widgets and HTML -->
    <table>
      <tr>
        <td valign="top">
          button bar via innerHTML:
        </td>
        <td valign="top" id="ButtonBar1"/>
      </tr>

      <tr>
        <td valign="top">
          button bar via append:
        </td>
        <td valign="top" id="ButtonBar2"/>
      </tr>

      <tr>
        <td valign="top">
          button bar via pure Mozilla processor:
        </td>
        <td valign="top" id="ButtonBar3"/>
      </tr>

      <tr>
        <td valign="top">
          button bar via xmlExtras:
        </td>
        <td valign="top" id="ButtonBar4"/>
      </tr>

    <script>

  var doc = Sarissa.getDomDocument();
  doc.async = false;
  // the following two lines are needed for IE
  doc.setProperty("SelectionNamespaces", "xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");
  doc.setProperty("SelectionLanguage", "XPath");
  doc.load("configWms3.xml");

  var stylesheet = new XslProcessor("/mapbuilder/lib/widget/tool/ButtonBar.xsl");
  var s = stylesheet.transformNodeToObject(doc, true);
alert(s.xml);

  var node1 = document.getElementById("ButtonBar1")
  node1.innerHTML = s.xml;
alert(node1.innerHTML);

  var node2 = document.getElementById("ButtonBar2")
  var removed = node2.removeChild( node2.firstChild );  //td el contains a text node by default
  node2.appendChild(document.importNode(s.documentElement,true));
alert(node2.innerHTML);

  var node3 = document.getElementById("ButtonBar3")
  removed = node3.removeChild( node3.firstChild );
  var xslResult = stylesheet.pureMozillaXslt(doc);
  node3.appendChild(xslResult);
alert(node3.innerHTML);

    </script>

  </body>
</html>
